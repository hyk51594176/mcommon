!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.mcommon=e()}(this,function(){"use strict";function t(t,e){var n=e.column,r=e.row,i=void 0===r?{}:r,o=e.$index,l=null,a=this.scopedSlots||this.$scopedSlots;return n.prop&&a[n.prop]&&(l=a[n.prop]({row:i,column:n,$index:o})),l||t("MItem",{props:{row:i,column:n,$index:o}})}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=function(e,n){var i={span:24},o=this.data.attrs,l=o.noWrap,a=o.model,u=o.formData,s=o.labelWidth;return void 0!==l&&(i={}),e("el-col",{props:r({span:11,xs:i},n),key:n.prop},[e("el-form-item",{props:r({},n,{labelWidth:n.label||n.labelWidth?n.labelWidth||s:"10px"})},[t.call(this,e,{column:n,row:a||u})])])},o={functional:!0,name:"MForm",render:function(t,e){return e.data.attrs.formData&&(e.data.attrs.model=e.data.attrs.formData),e.data.attrs.labelWidth||(e.data.attrs.labelWidth="100px"),e.data.attrs?t("el-form",e.data,[function(t){var e=this,n=this.data.attrs,r=n.columns,o=void 0===r?[]:r,l=n.elRow;return t("el-row",{props:l},o.map(function(n){return i.call(e,t,n)}))}.call(e,t)]):null}},l={name:"MItem",props:{row:{type:Object,required:!0},column:{type:Object,required:!0},$index:Number},data:function(){return{isForce:!1}},watch:{row:function(t,e){this.$parent.clearValidate&&t!==e&&this.$nextTick(this.$parent.clearValidate)}},computed:{computedColumn:function(){return r({},this.column,this.column.getColumn&&this.column.getColumn(this.row)||{})},componentType:function(){var t=this.computedColumn.el;return t?"mSelect"===t||"MSelect"===t||"select"===t||"el-select"===t?"m-select":t.startsWith("el-")?t:"el-"+t:null},valueKey:function(){return this.computedColumn.valueKey?this.computedColumn.valueKey:{label:"label",value:"value"}},modelComputed:{get:function(){var t=null;try{t=this.getStrFunction("this.row."+this.column.prop)}catch(t){this.setRowKey(null)}return"currency"===this.column.type&&t?this.isForce?t:this.currency(t,this.column.currency,this.column.decimals):t},set:function(t){if(this.computedColumn.rules){(Array.isArray(this.computedColumn.rules)?this.computedColumn.rules.some(function(t){return"number"===t.type}):"number"===this.computedColumn.rules.type)&&!isNaN(t)&&"el-input"===this.componentType&&(t=Number(t))}"currency"===this.computedColumn.type&&(t=isNaN(t)?0:Number(t));try{void 0===this.getStrFunction("this.row."+this.computedColumn.prop)?this.setRowKey(t):this.getStrFunction("this.row."+this.computedColumn.prop+" = value")}catch(e){this.setRowKey(t)}}}},methods:{getStrFunction:function(t){return t=t.replace(/(\.\d)/g,"[$1]").replace(/\.\[/g,"["),new Function("return "+t).call(this)},setRowKey:function(t){if(this.computedColumn.prop&&this.row){var e=this.computedColumn.prop.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split("."),n=e.shift(),r=e.length-1;if(r>=0){var i=this.row[n]||{},o=e.reduce(function(e,n,o){return o===r?(e[n]=t,i):(e[n]||(e[n]={}),e[n])},i);this.$set(this.row,n,JSON.parse(JSON.stringify(o)))}else this.$set(this.row,n,t)}},getParams:function(){var t={};if(this.computedColumn.params&&"object"===e(this.computedColumn.params))for(var n in this.computedColumn.params){var r=void 0;try{r=this.getStrFunction("this.row."+this.computedColumn.params[n])}catch(t){}t[n]=void 0!==r?r:this.computedColumn.params[n]}return t},currency:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"¥",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(t=parseFloat(t),!isFinite(t)||!t&&0!==t)return"";e=null!=e?e:"",n=null!=n?n:2;var r=Math.abs(t).toFixed(n),i=n?r.slice(0,-1-n):r,o=i.length%3,l=o>0?i.slice(0,o)+(i.length>3?",":""):"",a=n?r.slice(-1-n):"";return(t<0?"-":"")+e+l+i.slice(o).replace(/(\d{3})(?=\d)/g,"$1,")+a}},render:function(t){var e=this,n=this.row,i=this.$index,o=this.computedColumn,l=this.modelComputed,a=this.componentType,u=this.valueKey,s=this.getParams;if(a){var c=void 0!==o.placeholder?o.placeholder:o.label,p=r({},o.listeners||{},{input:function(t){e.modelComputed="el-input"===a?t.trim():t,o.listeners&&o.listeners.input&&o.listeners.input(t)}});o.listeners&&o.listeners.currentObj&&(p.currentObj=function(t){return o.listeners.currentObj(t,n,i)});if(["m-select","el-checkbox-group","el-radio-group"].includes(a)){var h="";"button"===o.type&&(h="-button");var d="m-select"!==a?function(t,e,n,i){return(n.dataList||n.list||[]).map(function(o){var l=void 0;return l=n.slots&&n.slots.default?[n.slots.default.call(null,t,o)]:o[i.label],t(e,{props:r({},n,{label:n.props?o[n.props.value]:o[i.value]}),key:o[i.label]},l)})}(t,"el-checkbox-group"===a?"el-checkbox"+h:"el-radio"+h,o,u):null;return t(a,{props:r({},o,{placeholder:c,params:"m-select"===a?s(o):null,value:l,customRender:o.slots&&o.slots.default?o.slots.default:null}),attrs:o,on:p},d)}"el-input"===a&&"currency"===o.type&&(p.blur=function(){var t;e.isForce=!1,o.listeners&&o.listeners.blur&&(t=o.listeners).blur.apply(t,arguments)},p.focus=function(){var t;e.isForce=!0,o.listeners&&o.listeners.focus&&(t=o.listeners).focus.apply(t,arguments)});var m=o.slots||{},f=[],g={};return Object.keys(m).forEach(function(e){var n=null;"function"==typeof m[e]?g[e]=m[e].bind(null,t):((n=m[e]).data=r({},n.data||{},{slot:e}),f.push(n))}),t(a,{props:r({},o,{filterable:!0,value:l,options:o,label:"el-checkbox"===a||"el-radio"===a?null:o.label}),attrs:{placeholder:c},scopedSlots:g,on:p},f)}return("function"==typeof o.render?o.render(t,{row:n,computedColumn:o,$index:i}):o.render)||t("span",{style:{"word-break":"break-all"}},o.format?o.format(n):l)}},a=function(t){return Object.prototype.toString.call(t).slice(8,-1)},u={name:"MSelect",props:{params:{type:Object,default:function(){return{}}},valueKey:{type:Object,default:function(){return{label:"label",value:"value"}}},nullRequest:Boolean,value:{type:[String,Boolean,Number,Array],default:""},dataList:Array,multiple:Boolean,showMsg:Boolean,getList:Function,customRender:Function},data:function(){return{list:[],currentValue:"",loading:!1,selectObj:{}}},watch:{params:function(t,e){(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e!==n&&(a(e)!==a(n)||null===e||null===n||("Array"===a(e)?e.length!==n.length||e.some(function(e,i){return t(e,n[i],r)}):"Object"===a(e)?r?e[r]!==n[r]:Object.keys(e).some(function(i){return t(e[i],n[i],r)}):"Date"!==a(e)||e.getTime()!==n.getTime()))})(t,e)&&this.pageInit()},value:function(t){this.setCurrentValue()},currentValue:function(t){this.$emit("input",t),this.getCurrentObj()},dataList:function(t){this.list=t},list:function(t){var e=this;this.changeCurrentValue();var n=t.filter(function(t){return t.checked});!n.length||this.currentValue||Array.isArray(this.currentValue)&&this.currentValue.length||(this.multiple?this.currentValue=n.map(function(t){return t[e.valueKey.value]}):this.currentValue=n[0][this.valueKey.value])}},created:function(){this.setCurrentValue(),this.dataList?this.list=this.dataList||[]:(this.dataList&&this.currentValue&&this.getCurrentObj(),this.params&&this.pageInit())},methods:{setCurrentValue:function(){this.multiple?Array.isArray(this.value)?this.currentValue=this.value:"string"==typeof this.value&&this.value?this.currentValue=this.value.split(","):this.currentValue=[]:this.currentValue=this.value},changeCurrentValue:function(){var t=this;this.list.length?this.multiple?this.currentValue&&this.currentValue.length&&(this.currentValue=this.currentValue.filter(function(e){return t.list.some(function(n){return n[t.valueKey.value]===e})})):null!==this.currentValue&&void 0!==this.currentValue&&""!==this.currentValue&&!this.list.some(function(e){return e[t.valueKey.value]===t.currentValue})&&(this.currentValue=null):this.multiple?this.currentValue=[]:this.currentValue=""},pageInit:function(){var t=this,e=Object.keys(this.params);if(e.length&&(e.some(function(e){return null===t.params[e]})&&!this.nullRequest))return;this.getData()},getCurrentObj:function(){var t=this;if(this.list.length){var e=null,n=this.valueKey.value;this.multiple?(e=[],this.currentValue.forEach(function(r){var i=t.list.find(function(t){return t[n]===r});i&&e.push(i)})):e=this.currentValue&&this.list.find(function(e){return e[n]===t.currentValue})||{},this.selectObj=e,this.$emit("currentObj",e)}},remoteMethod:function(t){void 0!==this.$attrs.remote&&!1!==this.$attrs.remote&&null!==this.$attrs.remote&&this.getData({keyWord:t})},getData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.getList&&(this.loading=!0,this.getList(r({},this.params,e),this.showMsg).then(function(e){var n=Array.isArray(e)?e:e.data||[];t.list=n,t.$emit("selectList",t.list),t.loading=!1}).catch(function(e){return t.list=[],t.loading=!1,Promise.reject(e)}))}},render:function(t){var e=this,n=this.list,i=this.valueKey,o=this.multiple,l=this.loading,a=this.currentValue,u=this.remoteMethod,s=this.$attrs,c=this.$listeners,p=this.customRender,h=r({},c,{clear:u,input:function(t){e.currentValue=t,c.input&&c.input(t)}}),d=r({},s);return delete d.valueKey,t("el-select",{props:r({loading:l,value:a,loadingText:"加载中",filterable:!0,clearable:!0,remoteMethod:u,multiple:o},d),style:{width:"100%"},on:h},[n.map(function(e){return t("el-option",{props:{label:e[i.label],value:e[i.value],disabled:e.disabled},key:e[i.value]},[p?p(t,e):null])})])}},s=function(t){var e=navigator.userAgent;return"ie"===t?!!(e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1)&&(new RegExp("MSIE (\\d+\\.\\d+);").test(e),parseFloat(RegExp.$1)):e.indexOf(t)>-1},c=function(t,e,n){var r=n.separator,i=n.quoted,o=e.map(function(t){return i?'"'+(t="string"==typeof t?t.replace(/"/g,'"'):t)+'"':t});t.push(o.join(r))},p={separator:",",quoted:!1},h={_isIE11:function(){var t=0,e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),n=!!navigator.userAgent.match(/Trident\/7.0/),r=navigator.userAgent.indexOf("rv:11.0");return e&&(t=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(t=10),n&&-1!==r&&(t=11),11===t},_isEdge:function(){return/Edge/.test(navigator.userAgent)},_getDownloadUrl:function(t){if(window.Blob&&window.URL&&window.URL.createObjectURL){var e=new window.Blob(["\ufeff"+t],{type:"text/csv"});return URL.createObjectURL(e)}return"data:attachment/csv;charset=utf-8,\ufeff"+encodeURIComponent(t)},download:function(t,e){if(s("ie")&&s("ie")<10){var n=window.top.open("about:blank","_blank");n.document.charset="utf-8",n.document.write(e),n.document.close(),n.document.execCommand("SaveAs",t),n.close()}else if(10===s("ie")||this._isIE11()||this._isEdge()){var r=new Blob(["\ufeff"+e],{type:"text/csv"});navigator.msSaveBlob(r,t)}else{var i=document.createElement("a");i.download=t,i.href=this._getDownloadUrl(e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}},format:function(t,e,n){n=Object.assign({},p,n);var r=[],i=t.map(function(t){return t.label});return c(r,i,n),e.forEach(function(e){Array.isArray(e)||(e=t.map(function(t){return void 0!==e[t.prop]?e[t.prop]:""})),c(r,e,n)}),r.join("\r\n")}},d=function e(n,i){var o=this,l=this.filtetag,a=this.getKey;return i.map(function(i,u){var s=i.children||[];return n("el-table-column",{props:r({},i,{className:i.className||i.el,align:i.align||"center",filterMethod:i.filters?l.bind(null,i):null}),key:a(i.prop),scopedSlots:{default:function(e){return function(e,n){var r=n.scope,i=n.column;n.index;return e("span",null,[t.call(this,e,{column:this.getColumns(i,r),row:r.row,$index:r.$index})])}.call(o,n,{scope:e,column:i,index:u})}}},e.call(o,n,s))})},m={name:"MTable",props:{tableData:{type:Array,default:function(){return[]}},buttonWidth:[String,Number],numWidth:[String,Number],buttonAlign:{type:String,default:"center"},pageOptions:Object,buttonFixed:{type:String,default:"right"},buttonLabel:{type:String,default:"操作"},reserveSelection:Boolean,layout:{type:String,default:"total,sizes,prev, pager, next, jumper"},showNum:{type:Boolean,default:!0},hideOnSinglePage:{type:Boolean,default:!0},selectable:{type:Function},numFiexd:Boolean,showPage:{type:Boolean,default:!0},forced:Boolean,showsummary:{type:Boolean,default:!1},summaryMethod:{type:Function},border:{type:Boolean,default:!0},stripe:{type:Boolean,default:!1},numTitle:{type:String,default:"序号"},total:Number,selection:{type:Boolean,default:!1},expand:Boolean,columns:{type:Array,default:function(){return[]}},page:{type:Object,default:function(){return{pageNum:1,pageSize:15,total:0}}},pageSizes:{type:Array,default:function(){return[15,30,45,60]}},mergeRow:{type:Array,default:function(){return[]}},mergeColumn:{type:Array,default:function(){return[]}},spanMethod:Function,sumText:{type:String,default:"合计"},pageAlign:{type:String,default:"right"}},inheritAttrs:!1,computed:{cTotal:function(){var t=this.total||this.page.total;return t||this.tableData.length},list:function(){var t=this,e=this.total||this.page.total;return!this.showPage||e?this.tableData:this.tableData.filter(function(e,n){return n>=(t.page.pageNum-1)*t.page.pageSize&&n<t.page.pageNum*t.page.pageSize})},summaryProps:function(){return this.columns.filter(function(t){return t.isSummary}).map(function(t){return t.prop})},isShowSummary:function(){return this.columns.some(function(t){return t.isSummary})},mergeRowData:function(){var t=this;return this.mergeRow.length?this.mergeRow.reduce(function(e,r){var i=void 0;return e[r]=t.list.reduce(function(t,e,o){var l=n({row:1},r,e[r]);return 0!==o&&e[r]===t[o-1][r]?(l.row=0,t[i].row+=1):i=o,t.push(l),t},[]),e},{}):{}}},watch:{tableData:function(){var t=this.total||this.page.total;!t&&isNaN(t)&&(this.page.pageNum=1)}},methods:{toggleRowExpansion:function(){var t;(t=this.$refs.commontable).toggleRowExpansion.apply(t,arguments)},exportCsv:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.filename?-1===t.filename.indexOf(".csv")&&(t.filename+=".csv"):t.filename="table.csv";var e=[],n=[];t.columns&&t.data?(e=t.columns,n=t.data):(e=this.columns,"original"in t||(t.original=!0),n=t.original?this.tableData:this.list);var r=h.format(e,n,t);t.callback?t.callback(r):h.download(t.filename,r)},getKey:function(t){return this.forced?(t||"")+Math.random()*Date.now():t},getColumns:function(t,e){var i=null;return t.listeners&&(i=Object.keys(t.listeners).reduce(function(i,o){return r({},i,n({},o,t.listeners[o].bind(null,e)))},{})),r({},t,{disabled:t.disabled||e.row.disabled,readonly:t.readonly||e.row.readonly,listeners:i})},summaryDefault:function(t){var e=this,n=t.columns,r=t.data,i=[];return n.forEach(function(t,n){if(0!==n){if(!(e.summaryProps.indexOf(t.property)<0)){var o=r.map(function(e){return Number(e[t.property])});o.every(function(t){return isNaN(t)})||(i[n]=o.reduce(function(t,e){var n=Number(e);return isNaN(n)?t:t+e},0)),i[n]=parseFloat(i[n]||0).toFixed(2);var l=t.property,a=l?e.columns.find(function(t){return t.prop===l}):null;a&&i[n]&&(a.isCurrency&&(i[n]=(i[n]+"").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")),a.unit&&(i[n]=i[n]+a.unit))}}else i[n]=e.sumText}),i},handleSizeChange:function(t){this.page.pageSize=t,this.$emit("pageChange",this.page)},handleCurrentChange:function(t){this.page.pageNum=t,this.$emit("pageChange",this.page)},toggleRowSelection:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];this.$nextTick(function(){e.forEach(function(e){t.$refs.commontable.toggleRowSelection(e,n)})})},clearSelection:function(){this.$refs.commontable.clearSelection()},filtetag:function(t,e,n){return"function"==typeof t.filterMethod?t.filterMethod(t,e,n):n[t.prop]===e},arraySpanMethod:function(t){var e=t.row,n=t.column,r=t.rowIndex,i=n.property?this.mergeRowData[n.property]:null,o=1,l=1;if(i&&(o=i[r].row),this.mergeColumn.length)if(this.mergeColumn.indexOf(n.property)>-1){var a=this.columns.map(function(t){return t.prop}),u=a.indexOf(n.property),s=!0;l=a.reduce(function(t,n,r){return r>u&&s&&(void 0===e[n]?t+=1:s=!1),t},1)}else n.property&&void 0===e[n.property]&&(l=0);return[o,l]}},render:function(t){return t("div",null,[function(t){var e=this,n=this.list,i=this.stripe,o=this.border,l=this.summaryMethod,a=this.summaryDefault,u=this.isShowSummary,s=this.$listeners,c=this.$attrs,p=this.expand,h=this.selection,m=this.selectable,f=this.showNum,g=this.reserveSelection,y=this.numTitle,v=this.numFiexd,b=this.numWidth,w=this.page,S=this.columns,x=this.buttonWidth,C=this.buttonAlign,$=this.buttonFixed,O=this.buttonLabel,V=this.mergeRow,N=this.mergeColumn,j=this.arraySpanMethod,M=this.spanMethod,A=[];if(p&&A.push(t("el-table-column",{props:{type:"expand"},key:"expand",scopedSlots:{default:this.$scopedSlots.expand?function(t){return e.$scopedSlots.expand(t)}:null}})),h&&n.length&&A.push(t("el-table-column",{props:{type:"selection",selectable:m,reserveSelection:g},key:"selection"})),f&&n.length){var R=function(t){return t.$index+1+(w.pageNum-1)*w.pageSize};A.push(t("el-table-column",{props:{label:y,align:"center",width:b||60,reserveSelection:g,fixed:v||S[0]&&S[0].fixed},key:"showNum",scopedSlots:{default:this.$scopedSlots.num?function(t){return e.$scopedSlots.mnum(r({},t,{num:R(t)}))}:function(t){return R(t)}}}))}this.$scopedSlots.button&&A.push(t("el-table-column",{props:{width:x,align:C||"center",fixed:$,label:O},key:"button",scopedSlots:{default:function(t){return e.$scopedSlots.button(t)}}}));var k=r({},s);return k.selectionChange&&(k["selection-change"]=k.selectionChange),t("el-table",{props:r({data:n,border:o,stripe:i,summaryMethod:l||a,showSummary:u,spanMethod:V.length||N.length?j:M},c),ref:"commontable",on:k},[].concat(A,this.$slots.default||[],d.call(this,t,S)))}.call(this,t),function(t){var e=this.showPage,n=this.pageAlign,i=this.page,o=this.pageSizes,l=this.layout,a=this.cTotal,u=this.handleSizeChange,s=this.handleCurrentChange,c=this.pageOptions,p=void 0===c?{}:c,h=this.hideOnSinglePage;return this.$scopedSlots.page?this.$scopedSlots.page():e?t("el-pagination",{props:r({currentPage:i.pageNum,pageSize:i.pageSize,pageSizes:o,layout:l,total:a,hideOnSinglePage:h},p),on:{"size-change":u,"current-change":s},style:{textAlign:n}}):null}.call(this,t)])}},f=function t(e){if(!t.installed){if(!e.prototype.$ELEMENT)throw new Error("请先安装element-ui");e.component(o.name,o),e.component(l.name,l),e.component(u.name,u),e.component(m.name,m)}};return window&&window.Vue&&f(window.Vue),{install:f,MForm:o,MItem:l,MSelect:u,MTable:m}});
