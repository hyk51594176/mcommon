!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Mcommon=t()}(this,function(){"use strict";function e(e,t){var n=t.column,i=t.row,r=void 0===i?{}:i,a=t.$index,l=null,o=this.scopedSlots||this.$scopedSlots;return n.prop&&o[n.prop]&&(l=o[n.prop]({row:r,column:n,$index:a})),l||e("MItem",{props:{row:r,column:n,$index:a}})}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i=function(t,i){var r={span:22},a=this.data.attrs,l=a.noWrap,o=a.model,s=a.formData;return void 0!==l&&(r={}),t("el-col",{props:n({span:11,xs:r},i),key:i.prop},[t("el-form-item",{props:n({},i,{labelWidth:i.label?i.labelWidth||"100px":"10px"})},[e.call(this,t,{column:i,row:o||s})])])},r={functional:!0,name:"MForm",render:function(e,t){return t.data.attrs.formData&&(t.data.attrs.model=t.data.attrs.formData),t.data.attrs.labelWidth||(t.data.attrs.labelWidth="100px"),t.data.attrs?e("el-form",t.data,[function(e){var t=this,n=this.data.attrs,r=n.columns,a=void 0===r?[]:r,l=n.elRow;return e("el-row",l,a.map(function(n){return i.call(t,e,n)}))}.call(t,e)]):null}},a={shortcuts:[{text:"今天",onClick:function(e){var t=new Date,n=new Date;e.$emit("pick",[n,t])}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",[t,t])}},{text:"最近一周",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-6048e5),e.$emit("pick",[n,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-2592e6),e.$emit("pick",[n,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-7776e6),e.$emit("pick",[n,t])}},{text:"最近六个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-15552e6),e.$emit("pick",[n,t])}},{text:"最近一年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-31536e6),e.$emit("pick",[n,t])}}]},l={name:"MItem",props:{row:{type:Object,required:!0},column:{type:Object,required:!0},$index:Number},data:function(){return{isForce:!1}},watch:{row:function(){this.$parent.clearValidate&&this.$parent.clearValidate()}},computed:{componentType:function(){var e=this.column.el;return e?"mSelect"===e||"MSelect"===e||"select"===e||"el-select"===e?"m-select":e.startsWith("el-")?e:"el-"+e:null},valueKey:function(){return this.column.valueKey?this.column.valueKey:{label:"label",value:"value"}},modelComputed:{get:function(){var e=null;try{e=this.getStrFunction("this.row."+this.column.prop)}catch(e){this.setRowKey(null)}return"currency"===this.column.type&&e?this.isForce?e:this.currency(e,this.column.currency,this.column.decimals):e},set:function(e){if(this.column.rules){(Array.isArray(this.column.rules)?this.column.rules.some(function(e){return"number"===e.type}):"number"===this.column.rules.type)&&!isNaN(e)&&(e=Number(e))}"currency"===this.column.type&&(e=isNaN(e)?0:Number(e));try{void 0===this.getStrFunction("this.row."+this.column.prop)?this.setRowKey(e):this.getStrFunction("this.row."+this.column.prop+" = value")}catch(t){this.setRowKey(e)}}}},methods:{getStrFunction:function(e){return e=e.replace(/(\.\d)/g,"[$1]").replace(/\.\[/g,"["),new Function("return "+e).call(this)},setRowKey:function(e){if(this.column.prop&&this.row){var t=this.column.prop.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split("."),n=t.shift(),i=t.length-1;if(i>=0){var r=this.row[n]||{},a=t.reduce(function(t,n,a){return a===i?(t[n]=e,r):(t[n]||(t[n]={}),t[n])},r);this.$set(this.row,n,JSON.parse(JSON.stringify(a)))}else this.$set(this.row,n,e)}},getParams:function(){var e={};if(this.column.params&&"object"===t(this.column.params))for(var n in this.column.params){var i=void 0;try{i=this.getStrFunction("this.row."+this.column.params[n])}catch(e){}e[n]=void 0!==i?i:this.column.params[n]}return e},getpickerOptions:function(e,t){if("daterange"===e&&!1!==t)return a},currency:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"¥",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(e=parseFloat(e),!isFinite(e)||!e&&0!==e)return"";t=null!=t?t:"",n=null!=n?n:2;var i=Math.abs(e).toFixed(n),r=n?i.slice(0,-1-n):i,a=r.length%3,l=a>0?r.slice(0,a)+(r.length>3?",":""):"",o=n?i.slice(-1-n):"";return(e<0?"-":"")+t+l+r.slice(a).replace(/(\d{3})(?=\d)/g,"$1,")+o}},render:function(e){var t=this,i=this.row,r=this.$index,a=this.column,l=this.modelComputed,o=this.componentType,s=this.valueKey;if(o){var u=void 0!==a.placeholder?a.placeholder:a.label,c=n({},a.listeners||{},{input:function(e){t.modelComputed=e,a.listeners&&a.listeners.input&&a.listeners.input(e)}});if(["m-select","el-checkbox-group","el-radio-group"].includes(o)){var h="m-select"!==o?function(e,t,i,r){return(i.dataList||i.list||[]).map(function(a){return e(t,{props:n({},i,{label:i.props?a[i.props.value]:a[r.value]}),key:a[r.label]},i.props?a[i.props.label]:a[r.label])})}(e,"el-checkbox-group"===o?"el-checkbox":"el-radio",a,s):null;return e(o,{props:n({},a,{placeholder:u,value:l}),on:c},h)}return"el-input"===o&&"currency"===a.type&&(c.blur=function(){var e;t.isForce=!1,a.listeners&&a.listeners.blur&&(e=a.listeners).blur.apply(e,arguments)},c.focus=function(){var e;t.isForce=!0,a.listeners&&a.listeners.focus&&(e=a.listeners).focus.apply(e,arguments)}),e(o,{props:n({},a,{filterable:!0,value:l}),attrs:{placeholder:u},on:c})}var p="function"==typeof a.render?a.render(e,{row:i,column:a,$index:r}):a.render,f=a.format?a.format(i):l;return p||e("span",null,f)}},o=function(e){return Object.prototype.toString.call(e).slice(8,-1)},s={name:"MSelect",props:{params:{type:Object,default:function(){return{}}},valueKey:{type:Object,default:function(){return{label:"label",value:"value"}}},nullRequest:Boolean,value:{type:[String,Boolean,Number,Array],default:""},dataList:Array,multiple:Boolean,showMsg:Boolean,getList:Function},inheritAttrs:!1,data:function(){return{list:[],currentValue:"",loading:!1,selectObj:{}}},watch:{params:function(e,t){(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t!==n&&(o(t)!==o(n)||null===t||null===n||("Array"===o(t)?t.length!==n.length||t.some(function(t,r){return e(t,n[r],i)}):"Object"===o(t)?i?t[i]!==n[i]:Object.keys(t).some(function(r){return e(t[r],n[r],i)}):"Date"!==o(t)||t.getTime()!==n.getTime()))})(e,t)&&this.pageInit()},value:function(e){this.setCurrentValue()},currentValue:function(e){this.$emit("input",e),this.getCurrentObj()},dataList:function(e){this.list=e},list:function(e){var t=this;this.changeCurrentValue();var n=e.filter(function(e){return e.checked});!n.length||this.currentValue||Array.isArray(this.currentValue)&&this.currentValue.length||(this.multiple?this.currentValue=n.map(function(e){return e[t.valueKey.value]}):this.currentValue=n[0][this.valueKey.value])}},created:function(){this.setCurrentValue(),this.dataList?this.list=this.dataList||[]:(this.dataList&&this.currentValue&&this.getCurrentObj(),this.params&&this.pageInit())},methods:{setCurrentValue:function(){this.multiple?Array.isArray(this.value)?this.currentValue=this.value:"string"==typeof this.value&&this.value?this.currentValue=this.value.split(","):this.currentValue=[]:this.currentValue=this.value},changeCurrentValue:function(){var e=this;this.list.length?this.multiple?this.currentValue&&this.currentValue.length&&(this.currentValue=this.currentValue.filter(function(t){return e.list.some(function(n){return n[e.valueKey.value]===t})})):null!==this.currentValue&&void 0!==this.currentValue&&""!==this.currentValue&&!this.list.some(function(t){return t[e.valueKey.value]===e.currentValue})&&(this.currentValue=null):this.multiple?this.currentValue=[]:this.currentValue=""},pageInit:function(){var e=this,t=Object.keys(this.params);if(t.length&&(t.some(function(t){return null===e.params[t]})&&!this.nullRequest))return;this.getData()},getCurrentObj:function(){var e=this;if(this.list.length){var t=null,n=this.valueKey.value;this.multiple?(t=[],this.currentValue.forEach(function(i){var r=e.list.find(function(e){return e[n]===i});r&&t.push(r)})):t=this.currentValue&&this.list.find(function(t){return t[n]===e.currentValue})||{},this.selectObj=t,this.$emit("currentObj",t)}},remoteMethod:function(e){void 0!==this.$attrs.remote&&!1!==this.$attrs.remote&&null!==this.$attrs.remote&&this.getData({keyWord:e})},getData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.getList&&(this.loading=!0,this.getList(n({},this.params,t),this.showMsg).then(function(t){var n=Array.isArray(t)?t:t.data||[];e.list=n,e.$emit("selectList",e.list),e.loading=!1}).catch(function(t){return e.list=[],e.loading=!1,Promise.reject(t)}))}},render:function(e){var t=this,i=this.list,r=this.valueKey,a=this.multiple,l=this.loading,o=this.currentValue,s=this.remoteMethod,u=this.$attrs,c=this.$listeners,h=n({},c,{clear:s,input:function(e){t.currentValue=e,c.input&&c.input(e)}});return e("el-select",{props:n({loading:l,value:o,loadingText:"加载中",filterable:!0,clearable:!0,remoteMethod:s,multiple:a},u),style:{width:"100%"},on:h},[i.map(function(t){return e("el-option",{props:{label:t[r.label],value:t[r.value],disabled:t.disabled},key:t[r.value]})})])}},u=function(e){var t=navigator.userAgent;return"ie"===e?!!(t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1)&&(new RegExp("MSIE (\\d+\\.\\d+);").test(t),parseFloat(RegExp.$1)):t.indexOf(e)>-1},c=function(e,t,n){var i=n.separator,r=n.quoted,a=t.map(function(e){return r?'"'+(e="string"==typeof e?e.replace(/"/g,'"'):e)+'"':e});e.push(a.join(i))},h={separator:",",quoted:!1},p={_isIE11:function(){var e=0,t=/MSIE (\d+\.\d+);/.test(navigator.userAgent),n=!!navigator.userAgent.match(/Trident\/7.0/),i=navigator.userAgent.indexOf("rv:11.0");return t&&(e=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(e=10),n&&-1!==i&&(e=11),11===e},_isEdge:function(){return/Edge/.test(navigator.userAgent)},_getDownloadUrl:function(e){if(window.Blob&&window.URL&&window.URL.createObjectURL){var t=new window.Blob(["\ufeff"+e],{type:"text/csv"});return URL.createObjectURL(t)}return"data:attachment/csv;charset=utf-8,\ufeff"+encodeURIComponent(e)},download:function(e,t){if(u("ie")&&u("ie")<10){var n=window.top.open("about:blank","_blank");n.document.charset="utf-8",n.document.write(t),n.document.close(),n.document.execCommand("SaveAs",e),n.close()}else if(10===u("ie")||this._isIE11()||this._isEdge()){var i=new Blob(["\ufeff"+t],{type:"text/csv"});navigator.msSaveBlob(i,e)}else{var r=document.createElement("a");r.download=e,r.href=this._getDownloadUrl(t),document.body.appendChild(r),r.click(),document.body.removeChild(r)}},format:function(e,t,n){var i=n.noHeader,r=void 0!==i&&i,a=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(n,["noHeader"]);a=Object.assign({},h,a);var l=void 0,o=[],s=[];return e?(l=e.map(function(e){return"string"==typeof e?e:(r||s.push(void 0!==e.label?e.label:e.key),e.key)}),s.length>0&&c(o,s,a)):(l=[],t.forEach(function(e){Array.isArray(e)||(l=l.concat(Object.keys(e)))}),l.length>0&&(l=l.filter(function(e,t,n){return n.indexOf(e)===t}),r||c(o,l,a))),Array.isArray(t)&&t.forEach(function(e){Array.isArray(e)||(e=l.map(function(t){return void 0!==e[t]?e[t]:""})),c(o,e,a)}),o.join("\r\n")}},f=function(t){var i=this,r=this.list,a=this.stripe,l=this.border,o=this.summarymethod,s=this.summaryDefault,u=this.isShowSummary,c=this.$listeners,h=this.$attrs,p=this.expand,f=this.isTree,d=this.selection,m=this.selectable,g=this.showNum,v=this.reserveSelection,y=this.numTitle,b=this.numFiexd,w=this.page,x=this.columns,S=this.filtetag,$=this.getKey,k=this.buttonWidth,D=this.buttonAlign,C=this.buttonFixed,A=this.buttonLabel,O=[];if(p&&!f&&O.push(t("el-table-column",{props:{type:"expand"},scopedSlots:{default:this.$scopedSlots.expand?function(e){return i.$scopedSlots.expand(e)}:null}})),d&&r.length&&O.push(t("el-table-column",{props:{type:"selection",selectable:m,reserveSelection:v}})),g&&r.length&&!f){var T=function(e){return e.$index+1+(w.pageNum-1)*w.pageSize};O.push(t("el-table-column",{props:{label:y,align:"center",width:60,reserveSelection:v,fixed:b||x[0]&&x[0].fixed},scopedSlots:{default:this.$scopedSlots.mnum?function(e){return i.$scopedSlots.mnum(n({},e,{num:T(e)}))}:function(e){return T(e)}}}))}return this.$scopedSlots.button&&O.push(t("el-table-column",{props:{width:k,align:D||"center",fixed:C,label:A},scopedSlots:{default:function(e){return i.$scopedSlots.button(e)}}})),t("el-table",{props:n({data:r,border:l,stripe:a,summarymethod:o||s,showSummary:u},h),on:c},[].concat(O,this.$children,x.map(function(r,a){return t("el-table-column",{props:n({},r,{className:r.className||r.el,align:r.align||"center",filterMethod:r.filters?S.bind(null,r):null}),key:$(r.prop),scopedSlots:{default:function(n){return function(t,n,i,r){var a=this.isTree,l=this.expandClick,o=this.getColumns,s=[];return n.row.treeLevel&&0===r&&s.push(t("span",{style:{minWidth:15*n.row.treeLevel+"px"}})),void 0!==n.row.expandAll&&0===r&&s.push(t("span",null,[t("i",{class:{"el-icon-minus":n.row.expandAll,"el-icon-plus":!n.row.expandAll},style:{cursor:"pointer",fontWeight:900,fontSize:"13px",marginRight:"10px"},on:{click:l.bind(null,n)}})])),s.push(e.call(this,t,{column:o(i,n),row:n.row,$index:n.$index})),t("span",{style:{display:a&&0===r?"flex":null}},s)}.call(i,t,n,r,a)}}})})))},d={name:"MTable",props:{tableData:{type:Array,default:function(){return[]}},isTree:Boolean,buttonWidth:[String,Number],buttonAlign:{type:String,default:"center"},buttonFixed:{type:String,default:"right"},buttonLabel:{type:String,default:"操作"},reserveSelection:Boolean,layout:{type:String,default:"total,sizes,prev, pager, next, jumper"},showNum:{type:Boolean,default:!0},selectable:{type:Function},numFiexd:Boolean,showPage:{type:Boolean,default:!0},forced:Boolean,showsummary:{type:Boolean,default:!1},summarymethod:{type:Function},border:{type:Boolean,default:!0},stripe:{type:Boolean,default:!1},numTitle:{type:String,default:"序号"},total:Number,selection:{type:Boolean,default:!1},expand:Boolean,columns:{type:Array,default:function(){return[]}},page:{type:Object,default:function(){return{pageNum:1,pageSize:15}}},pageSizes:{type:Array,default:function(){return[15,30,45,60]}}},inheritAttrs:!1,data:function(){return{treeData:this.formatTreeData(this.tableData)}},computed:{cTotal:function(){var e=this.total||this.page&&this.page.total;return e||(this.isTree?this.treeData.length:this.tableData.length)},list:function(){var e=this;if(this.isTree)return this.treeData;var t=this.total||this.page&&this.page.total;return this.showPage||!t?this.tableData:this.tableData.filter(function(t,n){return n>=(e.page.pageNum-1)*e.page.pageSize&&n<e.page.pageNum*e.page.pageSize})},summaryProps:function(){return this.columns.filter(function(e){return e.isSummary}).map(function(e){return e.prop})},isShowSummary:function(){return this.columns.some(function(e){return e.isSummary})}},watch:{tableData:function(){var e=this.total||this.page.total;!e&&isNaN(e)&&(this.page.pageNum=1),this.isTree&&(this.treeData=this.formatTreeData(this.tableData))}},methods:{formatTreeData:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.forEach(function(e){if(e.treeLevel=n,i.push(e),e.children&&e.children.length){var r=t.$attrs.rowKey||t.$attrs["row-key"];if(t.treeData&&t.treeData.length&&r){var a=t.treeData.find(function(t){return t[r]===e[r]})||{expandAll:!1};e.expandAll=a.expandAll}void 0===e.expandAll&&(e.expandAll=!1),!0===e.expandAll&&t.formatTreeData(e.children,n+1,i)}}),i},expandClick:function(e){e.row.expandAll=!e.row.expandAll,this.treeData=this.formatTreeData(this.tableData)},toggleRowExpansion:function(){var e;(e=this.$refs.commontable).toggleRowExpansion.apply(e,arguments)},exportCsv:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.filename?-1===e.filename.indexOf(".csv")&&(e.filename+=".csv"):e.filename="table.csv";var t=[],n=[];e.columns&&e.data?(t=e.columns,n=e.data):(t=this.columns,"original"in e||(e.original=!0),n=e.original?this.tableData:this.list);var i=p.format(t,n,e);e.callback?e.callback(i):p.download(e.filename,i)},getKey:function(e){return this.forced?(e||"")+Math.random()*Date.now():e},getColumns:function(e,t){var i=null;return e.listeners&&(i=Object.keys(e.listeners).reduce(function(i,r){return n({},i,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,e.listeners[r].bind(null,t)))},{})),n({},e,{disabled:e.disabled||t.row.disabled,readonly:e.readonly||t.row.readonly,listeners:i})},summaryDefault:function(e){var t=this,n=e.columns,i=e.data,r=[];return n.forEach(function(e,n){if(0!==n){if(!(t.summaryProps.indexOf(e.property)<0)){var a=i.map(function(t){return Number(t[e.property])});a.every(function(e){return isNaN(e)})||(r[n]=a.reduce(function(e,t){var n=Number(t);return isNaN(n)?e:e+t},0)),r[n]=parseFloat(r[n]||0).toFixed(2),"currency"===e.className&&r[n]&&(r[n]=(r[n]+"").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")),"Percentage"===e.className&&r[n]&&(r[n]=r[n]+"%")}}else r[n]="合计"}),r},handleSizeChange:function(e){this.page.pageSize=e,this.$emit("pageChange",this.page)},handleCurrentChange:function(e){this.page.pageNum=e,this.$emit("pageChange",this.page)},toggleRowSelection:function(e,t){var n=this;this.$nextTick(function(){e.forEach(function(e){n.$refs.commontable.toggleRowSelection(e,t)})})},clearSelection:function(){this.$refs.commontable.clearSelection()},handleSelectionChange:function(e){this.$listeners["selection-change"]||this.$emit("selectionChange",e)},sortChange:function(e){this.$listeners["sort-change"]||this.$emit("sortChange",e)},rowClick:function(e,t,n){this.$listeners["row-click"]||this.$emit("rowClick",e,t,n)},cellClick:function(e,t,n){this.$listeners["cell-click"]||this.$emit("cellClick",e,t,n)},currentChange:function(e){this.$listeners["current-change"]||this.$emit("currentChange",e)},filtetag:function(e,t,n){return"function"==typeof e.filterMethod?e.filterMethod(e,t,n):n[e.prop]===t},goto:function(e){this.$emit("gotolink",e)},currentObj:function(e,t,n){this.$emit("currentObj",e.row,t,n,e.$index)}},render:function(e){return e("div",null,[f.call(this,e),function(e){var t=this.showPage,n=this.isTree,i=this.page,r=this.pageSizes,a=this.layout,l=this.cTotal,o=this.handleSizeChange,s=this.handleCurrentChange;return this.$scopedSlots.page?this.$scopedSlots.page():t&&!n?e("el-pagination",{props:{currentPage:i.pageNum,pageSize:i.pageSize,pageSizes:r,layout:a,total:l},on:{"size-change":o,"current-change":s},style:{textAlign:"right"}}):null}.call(this,e)])}},m=function e(t){if(!e.installed){if(!t.prototype.$ELEMENT)throw new Error("请先安装element-ui");t.component(r.name,r),t.component(l.name,l),t.component(s.name,s),t.component(d.name,d)}};return window.Vue&&m(window.Vue),{install:m,MForm:r,MItem:l,MSelect:s,MTable:d}});
